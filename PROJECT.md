# Application de Visualisation des Options - Montreal Exchange

## üìã Vue d'ensemble

Application frontend pour visualiser les donn√©es des options scrap√©es depuis le Montreal Exchange via un workflow n8n.

## üèóÔ∏è Architecture

### Flux de donn√©es
1. **Frontend** : L'utilisateur s√©lectionne un symbole et clique sur "Scraper les donn√©es"
2. **API Route** : `/api/scrape` fait un proxy vers le webhook n8n (√©vite les probl√®mes CORS)
3. **n8n Webhook (GET)** : Re√ßoit le param√®tre `symbol` et lance le workflow
4. **n8n Workflow** : Scrape les donn√©es du Montreal Exchange
5. **Webhook Response** : n8n r√©pond avec les donn√©es JSON via "Respond to Webhook"
6. **Frontend** : Cr√©e un nouvel onglet avec les donn√©es et affiche dans un tableau

```
[Frontend] --POST /api/scrape--> [Next.js API Route]
                                       |
                                       v
                              [n8n Webhook GET + ?symbol=XXX]
                                       |
                                       v
                                  [Scraping Workflow]
                                       |
                                       v
                              [Respond to Webhook (JSON)]
                                       |
                                       v
[Frontend] <--JSON Response (tableau)--
     |
     v
[Syst√®me d'onglets avec historique]
```

## üéØ Fonctionnalit√©s Impl√©ment√©es

### ‚úÖ Phase 1 - MVP (Compl√©t√©)
- [x] S√©lection de symbole via liste d√©roulante (BTCQ, ETH, ETHQ, BTC)
- [x] Bouton pour d√©clencher le scraping
- [x] Affichage des donn√©es dans un tableau organis√©
- [x] Organisation intelligente : Call puis Put avec m√™me date et strike
- [x] Tri automatique par date croissante puis strike price
- [x] Coloration des lignes (Call = vert, Put = rouge)
- [x] √âtat de chargement avec spinner pendant le scraping
- [x] Gestion compl√®te des erreurs

### ‚úÖ Filtres Avanc√©s
- [x] Type (Call/Put)
- [x] Plage de dates (Date Min/Max) avec date picker
- [x] Strike price (min/max)
- [x] Volatilit√© (min/max)
- [x] Type d'option (Weekly/Standard)
- [x] Bouton "R√©initialiser" pour effacer tous les filtres

### ‚úÖ Tri des Donn√©es
- [x] Tri par Date
- [x] Tri par Strike_price
- [x] Tri par volatility
- [x] Tri par open_interest
- [x] Tri par bid_price
- [x] Tri par ask_price
- [x] Indicateur visuel ascendant/descendant (‚Üë/‚Üì)
- [x] Toggle asc/desc au clic

### ‚úÖ Syst√®me d'Onglets avec Historique
- [x] Conservation de toutes les recherches en onglets
- [x] Navigation entre les onglets
- [x] Fermeture d'onglet avec bouton √ó
- [x] Affichage du symbole et timestamp sur chaque onglet
- [x] Indicateur visuel de l'onglet actif
- [x] Les donn√©es persistent tant que l'onglet est ouvert

### ‚úÖ Export de Donn√©es
- [x] Export CSV avec nom de fichier dynamique
- [x] Filtrage des donn√©es export√©es selon les filtres actifs
- [x] √âchappement correct des caract√®res sp√©ciaux

### ‚úÖ S√©lection de Symboles
- [x] Liste compl√®te de 413+ symboles du Montreal Exchange
- [x] Affichage du nom complet apr√®s s√©lection
- [x] Liste d√©roulante avec symboles uniquement

### ‚úÖ Analyse IA avec OpenAI
- [x] Int√©gration de l'API OpenAI (GPT-4o)
- [x] Analyse automatique des donn√©es d'options
- [x] Recommandations d'investissement personnalis√©es
- [x] Identification des options √† acheter avec niveau de risque
- [x] Identification des options √† √©viter avec risques identifi√©s
- [x] Analyse des risques et strat√©gies
- [x] Affichage format√© en Markdown avec react-markdown
- [x] Listes num√©rot√©es et √† puces pour meilleure lisibilit√©
- [x] Espacement optimal entre sections
- [x] Emojis pour visualisation rapide (üìä ‚úÖ ‚ùå üí° ‚ö†Ô∏è üü¢ üü° üî¥)
- [x] Lignes de s√©paration entre sections
- [x] Avertissement de non-conseil financier

### ‚úÖ Dashboard Dark Mode Professionnel (Compl√©t√©)
- [x] Interface dark mode compl√®te (`/dark`)
- [x] 4 graphiques analytiques interactifs (Recharts)
  - Volatility Smile (IV par Strike)
  - Volume par Strike (Top 15 liquidit√©)
  - IV Term Structure (√©volution dans le temps)
  - Call/Put Ratio (sentiment du march√©)
- [x] Cartes de statistiques en temps r√©el
- [x] Layout en grille 2x2 responsive
- [x] Th√®me sombre professionnel (#0f1419, #1e2329)
- [x] Tooltips d√©taill√©s sur tous les graphiques
- [x] Export PDF avec pr√©visualisation
- [x] Capture haute qualit√© des graphiques
- [x] Analyse IA des donn√©es filtr√©es uniquement

### üîÑ Phase 3 - Am√©liorations Futures
- [ ] Sauvegarde des donn√©es en localStorage
- [ ] Recherche textuelle dans les donn√©es
- [ ] Pagination pour grandes quantit√©s de donn√©es
- [ ] Comparaison entre plusieurs symboles
- [ ] Historique des analyses IA
- [ ] Personnalisation du prompt IA
- [ ] Graphiques temps r√©el avec WebSocket

## üõ†Ô∏è Stack Technique

- **Framework** : Next.js 14 (App Router)
- **Langage** : TypeScript
- **Styling** : TailwindCSS
- **HTTP Client** : Axios
- **State Management** : React Hooks (useState, useMemo, useEffect)
- **IA** : OpenAI API (GPT-4)
- **Markdown Rendering** : react-markdown

## üìÅ Structure du Projet

```
/Options model/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scrape/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts           # API route proxy vers n8n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analyze/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts           # API route pour analyse IA
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                 # Layout Next.js
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                   # Page principale avec logique
‚îÇ   ‚îî‚îÄ‚îÄ globals.css                # Styles globaux TailwindCSS
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ OptionsTable.tsx           # Tableau avec organisation Call/Put
‚îÇ   ‚îú‚îÄ‚îÄ DataFilters.tsx            # Composant de filtrage et tri
‚îÇ   ‚îî‚îÄ‚îÄ AIAnalysis.tsx             # Composant d'analyse IA
‚îú‚îÄ‚îÄ .env.example                   # Template pour variables d'environnement
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ tailwind.config.js
‚îú‚îÄ‚îÄ postcss.config.js
‚îú‚îÄ‚îÄ next.config.js
‚îî‚îÄ‚îÄ PROJECT.md                     # Ce fichier
```

## üìä Structure des Donn√©es

### Format r√©el des donn√©es re√ßues de n8n

```typescript
interface OptionData {
  id: number;                    // ID unique (cach√© dans l'UI)
  createdAt: string;             // Date de cr√©ation (cach√©)
  updatedAt: string;             // Date de mise √† jour (cach√©)
  Quotes: 'call' | 'put';        // Type d'option
  Symbol: string;                // Ex: "BTCQ  251017C17.50"
  Date: string;                  // Date d'expiration (ISO format)
  Strike_price: number;          // Prix d'exercice
  bid_price: number;             // Prix d'achat
  ask_price: number;             // Prix de vente
  bid_size: number;              // Taille bid
  ask_size: number;              // Taille ask
  net_change: number;            // Changement net
  settlement_price: number;      // Prix de r√®glement
  open_interest: number;         // Int√©r√™t ouvert
  is_option: number;             // Flag option (0/1)
  is_weekly: number;             // Flag weekly (0/1)
  last_close_price: number;      // Dernier prix de cl√¥ture
  open_price: number;            // Prix d'ouverture
  high_price: number;            // Prix le plus haut
  low_price: number;             // Prix le plus bas
  nb_trades: number;             // Nombre de trades
  volatility: number;            // Volatilit√©
}

// Les donn√©es arrivent sous forme de tableau directement
type WebhookResponse = OptionData[];
```

### Colonnes cach√©es dans l'affichage
- `id`
- `createdAt`
- `updatedAt`

## üîó Configuration n8n

### Webhook URL
- **URL Production** : `http://localhost:5678/webhook/f6645a25-ad42-4d85-92e9-f2301bce649d`
- **M√©thode** : GET
- **Param√®tres** : `?symbol=SYMBOLE` (ex: `?symbol=BTCQ`)

### Configuration dans n8n
1. Node "Webhook" configur√© en mode GET
2. Option "Respond to Webhook" activ√©e
3. Retourne un tableau JSON d'options
4. Le symbole est r√©cup√©r√© via `{{ $request.query.symbol }}`

## üöÄ Installation & D√©marrage

```bash
# Installation des d√©pendances
npm install

# Configuration de la cl√© API OpenAI
# 1. Cr√©er un fichier .env.local √† la racine du projet
# 2. Ajouter votre cl√© API OpenAI :
echo "OPENAI_API_KEY=your_api_key_here" > .env.local

# D√©veloppement
npm run dev

# L'application sera accessible sur http://localhost:3000
```

## üîë Configuration OpenAI

Pour utiliser l'analyse IA, vous devez :

1. Obtenir une cl√© API sur [OpenAI Platform](https://platform.openai.com/api-keys)
2. Cr√©er un fichier `.env.local` √† la racine du projet
3. Ajouter la ligne : `OPENAI_API_KEY=votre_cl√©_api`
4. Red√©marrer le serveur de d√©veloppement

**Note** : Le fichier `.env.local` est dans `.gitignore` pour prot√©ger votre cl√© API.

## üí° Utilisation

1. **S√©lectionner un symbole** : Choisissez dans la liste d√©roulante (413+ symboles disponibles)
2. **Voir le nom complet** : Le nom de la compagnie s'affiche sous la liste d√©roulante
3. **Scraper** : Cliquez sur "Scraper les donn√©es"
4. **Naviguer** : Un nouvel onglet appara√Æt avec le symbole et l'heure
5. **Analyser avec IA** : Cliquez sur "Analyser avec IA" pour obtenir des recommandations d'investissement
6. **Filtrer** : Utilisez les filtres pour affiner les r√©sultats
7. **Trier** : Cliquez sur les boutons de tri pour organiser les donn√©es
8. **Exporter** : Cliquez sur "Exporter CSV" pour sauvegarder les donn√©es filtr√©es
9. **Comparer** : Gardez plusieurs onglets ouverts pour comparer diff√©rents symboles
10. **Fermer** : Cliquez sur √ó pour fermer un onglet

## ‚úÖ Checklist de D√©veloppement

- [x] Documentation initiale (PROJECT.md)
- [x] Initialisation Next.js + TypeScript
- [x] Configuration TailwindCSS
- [x] API route proxy pour √©viter CORS
- [x] S√©lection de symbole (413+ symboles)
- [x] Affichage du nom complet du symbole
- [x] Hook pour appel webhook
- [x] Composant tableau avec organisation Call/Put
- [x] Composant filtres et tri
- [x] Page principale avec syst√®me d'onglets
- [x] Gestion d'√©tat avec historique
- [x] Export CSV
- [x] Int√©gration OpenAI API
- [x] Composant d'analyse IA
- [x] Recommandations d'investissement IA
- [x] Tests avec donn√©es r√©elles
- [x] Int√©gration webhook n8n production
- [x] Documentation finale

## üêõ Issues R√©solues

### Probl√®me CORS (R√©solu)
- **Probl√®me** : Impossible d'appeler directement le webhook n8n depuis le frontend
- **Solution** : Cr√©ation d'une API route `/api/scrape` qui fait proxy

### Organisation des donn√©es (R√©solu)
- **Probl√®me** : Donn√©es brutes difficiles √† analyser
- **Solution** : Organisation automatique Call puis Put par date et strike

### Perte des donn√©es (R√©solu)
- **Probl√®me** : Les donn√©es disparaissaient √† chaque nouveau scrape
- **Solution** : Syst√®me d'onglets avec historique persistant

## üìù Notes Techniques

- Les colonnes `id`, `createdAt`, `updatedAt` sont automatiquement filtr√©es de l'affichage
- Le tri et le filtrage fonctionnent en temps r√©el avec `useMemo`
- Les dates sont converties en timestamps pour le tri et la comparaison
- Le syst√®me d'onglets utilise un ID unique bas√© sur `Date.now()`
- Les filtres sont ind√©pendants pour chaque onglet actif
- L'analyse IA utilise GPT-4 avec un prompt sp√©cialis√© en trading d'options
- Les recommandations IA sont affich√©es en markdown avec react-markdown
- La cl√© API OpenAI est stock√©e en variable d'environnement pour la s√©curit√©

## ü§ñ Fonctionnement de l'Analyse IA

L'analyse IA fonctionne comme suit :

1. L'utilisateur clique sur "Analyser avec IA"
2. Les donn√©es d'options sont envoy√©es √† l'API `/api/analyze`
3. L'API pr√©pare un r√©sum√© structur√© des donn√©es
4. Un prompt d√©taill√© est envoy√© √† GPT-4o demandant :
   - Vue d'ensemble du march√© (3-4 points num√©rot√©s)
   - 3-5 options recommand√©es (avec raisons et niveau de risque üü¢üü°üî¥)
   - 3-5 options √† √©viter (avec raisons et risques identifi√©s)
   - Recommandations strat√©giques (num√©rot√©es)
   - Avertissements sur les risques (num√©rot√©s)
5. La r√©ponse est format√©e en **Markdown** avec espacement optimal
6. `react-markdown` interpr√®te et affiche le Markdown avec style
7. Un avertissement rappelle que ce ne sont pas des conseils financiers

### D√©tails du Prompt OpenAI

**Message Syst√®me :**
```
Tu es un expert en trading d'options et en analyse financi√®re.
Tes analyses sont bas√©es sur les donn√©es fournies et tu donnes
des recommandations claires et justifi√©es.
```

**Prompt Principal :**
Le prompt demande une structure Markdown avec :
- Titres `## ` pour les sections principales (üìä ‚úÖ ‚ùå üí° ‚ö†Ô∏è)
- Sous-titres `### üéØ` pour chaque option analys√©e
- Listes **num√©rot√©es** (1. 2. 3.) pour les points principaux
- Listes **√† puces** (- ‚Ä¢) pour les d√©tails de chaque option
- Lignes de s√©paration `---` entre sections
- **Lignes vides** entre chaque √©l√©ment pour l'espacement
- Emojis pour visualisation rapide
- Indicateurs de risque : üü¢ Faible / üü° Moyen / üî¥ √âlev√©

**Donn√©es envoy√©es √† l'IA :**
Chaque option est r√©sum√©e avec :
- `type`: Call ou Put
- `date`: Date d'expiration
- `strike`: Strike price
- `bid`: Prix d'achat
- `ask`: Prix de vente
- `volatility`: Volatilit√©
- `openInterest`: Int√©r√™t ouvert
- `isWeekly`: Weekly ou Standard

**Configuration du mod√®le :**
- **Mod√®le** : `gpt-4o` (GPT-4 Optimized)
- **Temperature** : `0.7` (√©quilibre cr√©ativit√©/coh√©rence)
- **Max tokens** : `2000` (analyse d√©taill√©e)

**Affichage :**
- `react-markdown` avec plugin `remark-gfm`
- Classes Tailwind `prose` pour le style
- Espacement personnalis√© : `space-y-2` pour listes, `mt-8` pour titres, `my-8` pour s√©parateurs
- Scroll automatique si contenu > 800px

---

**Derni√®re mise √† jour** : 2025-10-03
**Status** : üü¢ Version 2.1 - Analyse IA avec Markdown Optimis√©
**Version** : 2.1.0

## üéâ R√©sum√© des fonctionnalit√©s compl√®tes

L'application **Options Viewer** est maintenant compl√®te avec :

‚úÖ **Scraping & Affichage**
- Scraping des donn√©es via n8n webhook
- Affichage organis√© Call/Put avec couleurs
- 413+ symboles du Montreal Exchange
- Syst√®me d'onglets avec historique

‚úÖ **Filtrage & Tri**
- Filtres multiples (Type, Date, Strike, Volatilit√©, Weekly/Standard)
- Tri par 6 colonnes diff√©rentes
- R√©initialisation rapide des filtres

‚úÖ **Export**
- Export CSV avec donn√©es filtr√©es
- Nom de fichier dynamique avec symbole et date

‚úÖ **Analyse IA**
- Analyse automatique par GPT-4o
- Recommandations d'achat/vente personnalis√©es
- Niveaux de risque visuels (üü¢üü°üî¥)
- Affichage Markdown √©l√©gant et espac√©
- Emojis pour navigation rapide
